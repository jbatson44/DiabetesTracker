@{
    ViewBag.Title = "Export Data";
}
@model Diabetes.Models.User
    
    <div>
        <h1>Export Data</h1><br />
        <div>
            <h4>Select the dates to include:</h4>
            <input type="datetime-local" id="startTime" />
            <input type="datetime-local" id="endTime" />
        </div>

        <div>
            <h4>Select the data to include:</h4>
            <div>
                <label for="bloodSugar">Blood Sugar:</label>
                <input type="checkbox" id="bloodSugar" value="Blood" /><br />
                <label for="carbs">Carbs:</label>
                <input type="checkbox" id="carbs" value="Carbs" /><br />
                <label for="insulin">Insulin:</label>
                <input type="checkbox" id="insulin" value="Insulin" /><br />
            </div>
        </div>
        <input type="button" id="exportButton" value="Export" />
    </div>

    <script>
        $(document).ready(function () {
            $('#exportButton').click(function () {
                var includeBlood = false;
                var includeCarbs = false;
                var includeInsulin = false;
                if ($("#bloodSugar").is(':checked')) {
                    includeBlood = true;
                }
                if ($("#carbs").is(':checked')) {
                    includeCarbs = true;
                }
                if ($("#insulin").is(':checked')) {
                    includeInsulin = true;
                }

                var startTime = $('#startTime').val();
                var endTime = $('#endTime').val();

                if ((startTime != null && endTime != null) && (includeBlood == true || includeCarbs == true || includeInsulin == true)) {
                    $.ajax({
                        url: "/Home/CreateExcelFile",
                        data: {
                            'startTime': startTime,
                            'endTime': endTime,
                            'includeBlood': includeBlood,
                            'includeCarbs': includeCarbs,
                            'includeInsulin': includeInsulin
                        },
                        type: "POST",
                        success: function (data) {
                            //alert("succes");
                            //var response = JSON.parse(data);
                            window.location.href = "@Url.RouteUrl(new { Controller = "Home", Action = "DownloadExcelFile" })/?fileName=" + data.fileName;
                        },
                        error: function (data) {
                            alert("failure");
                        }
                    });
                }
            });
        });
    </script>
